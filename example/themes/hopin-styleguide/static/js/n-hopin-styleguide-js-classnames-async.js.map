{"version":3,"file":"n-hopin-styleguide-js-classnames-async.js","sources":["../../../src/static/js/n-hopin-styleguide-js-classnames-async.ts"],"sourcesContent":["const CLASSNAMES_CONTAINER_SELECTOR = '.n-hopin-styleguide-js-classnames';\n\nclass ClassName {\n  generateReport(): ClassNameReport {\n    const report: ClassNameReport = {\n      idSelectors: [],\n      ignoredSelectors: [],\n      elementSelectors: [],\n      validSelectors: [],\n      invalidSelectors: [],\n      namespaces: {},\n    };\n\n    for (const s of document.styleSheets) {\n      try {\n        const cssStylesheet = s as CSSStyleSheet;\n        for (const r of cssStylesheet.cssRules) {\n          // ((?:[a-z0-9]|-(?=[a-z0-9]))+) uses look ahead.\n          // Match a-z0-9 OR a - followed by a-z0-9\n          if (r instanceof CSSStyleRule) {\n            const selectors = this.splitSelectors(r.selectorText);\n            for (const s of selectors) {\n              const firstChar = s.substring(0, 1);\n              switch (firstChar) {\n                case '.':\n                  const regex = /^\\.(?:n-([a-z0-9-]*)-)?([cul])-((?:[a-z0-9]|-(?=[a-z0-9]))+)(?:__((?:[a-z0-9]|-(?=[a-z0-9]))+))?(?:--((?:[a-z0-9]|-(?=[a-z0-9]))+))?(?::(?:hover|active|focus|visited))*?$/;\n                  const results = regex.exec(s);\n                  if (!results) {\n                    report.invalidSelectors.push({\n                      rawSelector: r.selectorText,\n                      currentSelector: s,\n                    });\n                    break;\n                  }\n                  report.validSelectors.push({\n                    rawSelector: r.selectorText,\n                    currentSelector: s,\n                  });\n                  const namespace = results[1] || '';\n                  const type = results[2];\n                  const body = results[3];\n                  const element = results[4];\n                  const modifier = results[5];\n\n                  if (namespace == 'hopin-styleguide') {\n                    continue;\n                  }\n\n                  if (!report.namespaces[namespace]) {\n                    report.namespaces[namespace] = {\n                      name: namespace,\n                      types: {},\n                    };\n                  }\n\n                  if (!report.namespaces[namespace].types[type]) {\n                    report.namespaces[namespace].types[type] = {};\n                  }\n\n                  if (!report.namespaces[namespace].types[type][body]) {\n                    report.namespaces[namespace].types[type][body] = {\n                      name: body,\n                      elements: {},\n                      modifiers: [],\n                    };\n                  }\n\n                  if (element) {\n                    if (!report.namespaces[namespace].types[type][body].elements[element]) {\n                      report.namespaces[namespace].types[type][body].elements[element] = {\n                        name: element,\n                        modifiers: [],\n                      };\n                    }\n                    if (modifier && !report.namespaces[namespace].types[type][body].elements[element].modifiers.includes(modifier)) {\n                      report.namespaces[namespace].types[type][body].elements[element].modifiers.push(modifier);\n                    }\n                  } else if (modifier) {\n                    report.namespaces[namespace].types[type][body].modifiers.push(modifier);\n                  }\n                  console.log(`href: ${cssStylesheet.href}`);\n                  console.log(`namespace: ${namespace}`);\n                  console.log(`type     : ${type}`);\n                  console.log(`body     : ${body}`);\n                  console.log(`element  : ${element}`);\n                  console.log(`modifier : ${modifier}`);\n                  console.log('');\n                  break;\n                case '#':\n                  report.idSelectors.push({\n                      rawSelector: r.selectorText,\n                      currentSelector: s,\n                  });\n                  break;\n                case ':':\n                  report.ignoredSelectors.push({\n                      rawSelector: r.selectorText,\n                      currentSelector: s,\n                  });\n                  break;\n                default:\n                  report.elementSelectors.push({\n                      rawSelector: r.selectorText,\n                      currentSelector: s,\n                  });\n              }\n            }\n          }\n        }\n      } catch (err) {\n        // External stylesheets will not be accessible from JavaScript\n        // in which case this error will be thrown.\n        console.error(`Unable to read styles for ${s.href}`, err);\n      }\n    }\n    return report;\n  }\n\n  render() {\n      const containerElement = document.querySelector(CLASSNAMES_CONTAINER_SELECTOR);\n      if (!containerElement) {\n          console.warn(`Unable to find container with class ${CLASSNAMES_CONTAINER_SELECTOR}`)\n          return;\n      }\n\n      const report = this.generateReport();\n      if (Object.keys(report.namespaces).length > 0) {\n          containerElement.appendChild(this.renderNamespaces(report))\n      }\n  }\n\n  renderNamespaces(report: ClassNameReport) {\n      const namespaceSection = document.createElement('div');\n\n      const namespaces = Object.keys(report.namespaces).sort();\n      for (const namespace of namespaces) {\n          const titleEle = document.createElement('h2');\n          if (namespace) {\n            titleEle.textContent = `Namespace: ${namespace}`;\n          } else {\n            titleEle.textContent = 'No Namespace';\n          }\n          \n          namespaceSection.appendChild(titleEle);\n\n          const types = Object.keys(report.namespaces[namespace].types).sort();\n          for (const type of types) {\n              let typeName = type;\n              switch (type) {\n                  case 'c':\n                      typeName = 'Components';\n                      break;\n                  case 'l':\n                      typeName = 'Layouts';\n                      break;\n                  case 'u':\n                      typeName = 'Utilities';\n                      break;\n              }\n              const typeTitle = document.createElement('h3');\n              typeTitle.textContent = typeName;\n              namespaceSection.appendChild(typeTitle);\n              namespaceSection.appendChild(this.renderBEMList(report.namespaces[namespace].types[type]));\n          }\n      }\n\n      return namespaceSection;\n  }\n\n  renderBEMList(bemElements: {[key: string]: BEMBody}): HTMLElement {\n      const bodyList = document.createElement('ul');\n      const bodies = Object.keys(bemElements).sort();\n      for (const body of bodies) {\n          const nameLi = document.createElement('li');\n          nameLi.textContent = body;\n          bodyList.appendChild(nameLi);\n\n          const elements = Object.keys(bemElements[body].elements);\n          if (elements.length > 0) {\n              bodyList.appendChild(this.renderElements(bemElements[body].elements));\n          }\n\n          const modifiers = bemElements[body].modifiers;\n          if (modifiers.length > 0) {\n              bodyList.appendChild(this.renderModifiers(modifiers));\n          }\n      }\n      return bodyList;\n  }\n\n  renderElements(elements: {[key: string]: BEMElement}): HTMLElement {\n      const elementList = document.createElement('ul');\n      const sortedElements = Object.keys(elements).sort();\n      for (const element of sortedElements) {\n          const nameLi = document.createElement('li');\n          nameLi.textContent = `&#8627; ${element}`;\n          elementList.appendChild(nameLi);\n\n          const modifiers = elements[element].modifiers;\n          if (modifiers.length > 0) {\n              elementList.appendChild(this.renderModifiers(modifiers));\n          }\n      }\n      return elementList\n  }\n\n  renderModifiers(modifiers: string[]): HTMLElement {\n      const modifierList = document.createElement('ul');\n      for (const modifier of modifiers.sort()) {\n          const nameLi = document.createElement('li');\n          nameLi.textContent = `â†  ${modifier}`;\n          modifierList.appendChild(nameLi);\n      }\n      return modifierList;\n  }\n\n  splitSelectors(selector: string) {\n      return selector.split(/(?:\\s|,)+/);\n  }\n}\n\nwindow.addEventListener('load', function() {\n  new ClassName().render();\n})\n\ninterface Selector {\n  rawSelector: string;\n  currentSelector: string;\n}\n\ninterface BEMElement {\n  name: string;\n  modifiers: string[];\n}\n\ninterface BEMBody {\n  name: string;\n  elements: {[key: string]: BEMElement};\n  modifiers: string[];\n}\n\ninterface Namespace {\n  name: string;\n  types: {[key: string]: {[key: string]: BEMBody}};\n}\n\ninterface ClassNameReport {\n  idSelectors: Selector[];\n  ignoredSelectors: Selector[];\n  elementSelectors: Selector[];\n  validSelectors: Selector[];\n  invalidSelectors: Selector[];\n  namespaces: {[key: string]: Namespace};\n}"],"names":["ClassName","[object Object]","report","idSelectors","ignoredSelectors","elementSelectors","validSelectors","invalidSelectors","namespaces","s","document","styleSheets","cssStylesheet","r","cssRules","CSSStyleRule","selectors","this","splitSelectors","selectorText","substring","results","exec","push","rawSelector","currentSelector","namespace","type","body","element","modifier","name","types","elements","modifiers","includes","console","log","href","err","error","containerElement","querySelector","warn","generateReport","Object","keys","length","appendChild","renderNamespaces","namespaceSection","createElement","sort","titleEle","textContent","typeName","typeTitle","renderBEMList","bemElements","bodyList","bodies","nameLi","renderElements","renderModifiers","elementList","sortedElements","modifierList","selector","split","window","addEventListener","render"],"mappings":"yBAEA,MAAMA,EACJC,iBACE,MAAMC,EAA0B,CAC9BC,YAAa,GACbC,iBAAkB,GAClBC,iBAAkB,GAClBC,eAAgB,GAChBC,iBAAkB,GAClBC,WAAY,IAGd,IAAK,MAAMC,KAAKC,SAASC,YACvB,IACE,MAAMC,EAAgBH,EACtB,IAAK,MAAMI,KAAKD,EAAcE,SAG5B,GAAID,aAAaE,aAAc,CAC7B,MAAMC,EAAYC,KAAKC,eAAeL,EAAEM,cACxC,IAAK,MAAMV,KAAKO,EAAW,CAEzB,OADkBP,EAAEW,UAAU,EAAG,IAE/B,IAAK,IACH,MACMC,EADQ,6KACQC,KAAKb,GAC3B,IAAKY,EAAS,CACZnB,EAAOK,iBAAiBgB,KAAK,CAC3BC,YAAaX,EAAEM,aACfM,gBAAiBhB,IAEnB,MAEFP,EAAOI,eAAeiB,KAAK,CACzBC,YAAaX,EAAEM,aACfM,gBAAiBhB,IAEnB,MAAMiB,EAAYL,EAAQ,IAAM,GAC1BM,EAAON,EAAQ,GACfO,EAAOP,EAAQ,GACfQ,EAAUR,EAAQ,GAClBS,EAAWT,EAAQ,GAEzB,GAAiB,oBAAbK,EACF,SAGGxB,EAAOM,WAAWkB,KACrBxB,EAAOM,WAAWkB,GAAa,CAC7BK,KAAML,EACNM,MAAO,KAIN9B,EAAOM,WAAWkB,GAAWM,MAAML,KACtCzB,EAAOM,WAAWkB,GAAWM,MAAML,GAAQ,IAGxCzB,EAAOM,WAAWkB,GAAWM,MAAML,GAAMC,KAC5C1B,EAAOM,WAAWkB,GAAWM,MAAML,GAAMC,GAAQ,CAC/CG,KAAMH,EACNK,SAAU,GACVC,UAAW,KAIXL,GACG3B,EAAOM,WAAWkB,GAAWM,MAAML,GAAMC,GAAMK,SAASJ,KAC3D3B,EAAOM,WAAWkB,GAAWM,MAAML,GAAMC,GAAMK,SAASJ,GAAW,CACjEE,KAAMF,EACNK,UAAW,KAGXJ,IAAa5B,EAAOM,WAAWkB,GAAWM,MAAML,GAAMC,GAAMK,SAASJ,GAASK,UAAUC,SAASL,IACnG5B,EAAOM,WAAWkB,GAAWM,MAAML,GAAMC,GAAMK,SAASJ,GAASK,UAAUX,KAAKO,IAEzEA,GACT5B,EAAOM,WAAWkB,GAAWM,MAAML,GAAMC,GAAMM,UAAUX,KAAKO,GAEhEM,QAAQC,IAAI,SAASzB,EAAc0B,QACnCF,QAAQC,IAAI,cAAcX,KAC1BU,QAAQC,IAAI,cAAcV,KAC1BS,QAAQC,IAAI,cAAcT,KAC1BQ,QAAQC,IAAI,cAAcR,KAC1BO,QAAQC,IAAI,cAAcP,KAC1BM,QAAQC,IAAI,IACZ,MACF,IAAK,IACHnC,EAAOC,YAAYoB,KAAK,CACpBC,YAAaX,EAAEM,aACfM,gBAAiBhB,IAErB,MACF,IAAK,IACHP,EAAOE,iBAAiBmB,KAAK,CACzBC,YAAaX,EAAEM,aACfM,gBAAiBhB,IAErB,MACF,QACEP,EAAOG,iBAAiBkB,KAAK,CACzBC,YAAaX,EAAEM,aACfM,gBAAiBhB,OAM/B,MAAO8B,GAGPH,QAAQI,MAAM,6BAA6B/B,EAAE6B,OAAQC,GAGzD,OAAOrC,EAGTD,SACI,MAAMwC,EAAmB/B,SAASgC,cAvHF,qCAwHhC,IAAKD,EAED,YADAL,QAAQO,KAAK,yEAIjB,MAAMzC,EAASe,KAAK2B,iBAChBC,OAAOC,KAAK5C,EAAOM,YAAYuC,OAAS,GACxCN,EAAiBO,YAAY/B,KAAKgC,iBAAiB/C,IAI3DD,iBAAiBC,GACb,MAAMgD,EAAmBxC,SAASyC,cAAc,OAE1C3C,EAAaqC,OAAOC,KAAK5C,EAAOM,YAAY4C,OAClD,IAAK,MAAM1B,KAAalB,EAAY,CAChC,MAAM6C,EAAW3C,SAASyC,cAAc,MAEtCE,EAASC,YADP5B,EACqB,cAAcA,IAEd,eAGzBwB,EAAiBF,YAAYK,GAE7B,MAAMrB,EAAQa,OAAOC,KAAK5C,EAAOM,WAAWkB,GAAWM,OAAOoB,OAC9D,IAAK,MAAMzB,KAAQK,EAAO,CACtB,IAAIuB,EAAW5B,EACf,OAAQA,GACJ,IAAK,IACD4B,EAAW,aACX,MACJ,IAAK,IACDA,EAAW,UACX,MACJ,IAAK,IACDA,EAAW,YAGnB,MAAMC,EAAY9C,SAASyC,cAAc,MACzCK,EAAUF,YAAcC,EACxBL,EAAiBF,YAAYQ,GAC7BN,EAAiBF,YAAY/B,KAAKwC,cAAcvD,EAAOM,WAAWkB,GAAWM,MAAML,MAI3F,OAAOuB,EAGXjD,cAAcyD,GACV,MAAMC,EAAWjD,SAASyC,cAAc,MAClCS,EAASf,OAAOC,KAAKY,GAAaN,OACxC,IAAK,MAAMxB,KAAQgC,EAAQ,CACvB,MAAMC,EAASnD,SAASyC,cAAc,MACtCU,EAAOP,YAAc1B,EACrB+B,EAASX,YAAYa,GAEJhB,OAAOC,KAAKY,EAAY9B,GAAMK,UAClCc,OAAS,GAClBY,EAASX,YAAY/B,KAAK6C,eAAeJ,EAAY9B,GAAMK,WAG/D,MAAMC,EAAYwB,EAAY9B,GAAMM,UAChCA,EAAUa,OAAS,GACnBY,EAASX,YAAY/B,KAAK8C,gBAAgB7B,IAGlD,OAAOyB,EAGX1D,eAAegC,GACX,MAAM+B,EAActD,SAASyC,cAAc,MACrCc,EAAiBpB,OAAOC,KAAKb,GAAUmB,OAC7C,IAAK,MAAMvB,KAAWoC,EAAgB,CAClC,MAAMJ,EAASnD,SAASyC,cAAc,MACtCU,EAAOP,YAAc,WAAWzB,IAChCmC,EAAYhB,YAAYa,GAExB,MAAM3B,EAAYD,EAASJ,GAASK,UAChCA,EAAUa,OAAS,GACnBiB,EAAYhB,YAAY/B,KAAK8C,gBAAgB7B,IAGrD,OAAO8B,EAGX/D,gBAAgBiC,GACZ,MAAMgC,EAAexD,SAASyC,cAAc,MAC5C,IAAK,MAAMrB,KAAYI,EAAUkB,OAAQ,CACrC,MAAMS,EAASnD,SAASyC,cAAc,MACtCU,EAAOP,YAAc,KAAKxB,IAC1BoC,EAAalB,YAAYa,GAE7B,OAAOK,EAGXjE,eAAekE,GACX,OAAOA,EAASC,MAAM,cAI5BC,OAAOC,iBAAiB,QAAQ,YAC9B,IAAItE,GAAYuE"}